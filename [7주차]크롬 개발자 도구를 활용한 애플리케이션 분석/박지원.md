# 7.1 크롬 개발자 도구란?

- 크롬에서 제공하는 개발자용 도구로 웹페이지에서 일어나는 거의 모든 일을 확인할 수 있는 강력한 개발 도구
- 시크릿 모드에서 페이지와 개발자 도구를 여는 것을 권장
  - 브라우저에 설치된 확장 프로그램의 변수를 제거하기 위해

<br>

# 7.2 요소 탭

## 7.2.1 요소 화면

- 현재 화면 웹페이지를 구성하는 HTML을 나타냄
- 웹페이지의 DOM을 직접적으로 수정 가능
  - 프로덕션으로 개발된 페이지에서 수정 내용이 어떻게 보이는지 미리 확인할 수 있어 편리함

## 7.2.2 요소 정보

#### 스타일(Style)

- 요소와 관련된 스타일 정보
- 매핑된 클래스, 태그명, 아이디 등을 확인할 수 있고, 스타일이 선언된 파일도 확인 가능
- 해당 스타일이 `어디서 왔는지`를 나타냄

#### 계산됨(Computed)

- 해당 요소의 크기, padding, border, margin과 각종 CSS 적용 결괏값을 알 수 있는 탭
- 적용된 스타일이 `결과적으로 어떤 결과물`로 나타났는지 확인할 수 있음

#### 레이아웃(Layout)

- 그리드, 레이아웃에 관련된 정보

#### 이벤트 리스너(Event listener)

- 현재 요소에 부착된 각종 이벤트 리스너를 확인할 수 있음
- 이벤트 버블링 등으로 이벤트를 발생시키는 경우에는 확인이 어려움

#### DOM 중단점(DOM Breakpoints)

- 중단점이 있는지 알려주는 탭

#### 속성(Properties)

- 해당 요소가 가지고 있는 속성값
- 자바스크립트에서 해당 DOM으로 `.attributes`를 실행했을 때 나오는 결과와 비슷
- `.attributes`는 직접 할당된 값만 나오는 반면 속성 탭에는 모든 값이 나온다는 차이가 있음

#### 접근성(Accessibility)

- 웹 이용에 어려움을 겪는 장애인, 노약자를 위한 스크린리더기 등이 활용하는 값을 확인

<br>

# 7.3 소스 탭

- 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일 확인 가능
- 자바스크립트 파일부터 CSS, HTML, 폰트까지 다양한 파일 정보 확인
- 소스 중단점
  - 자바스크립트 실행을 중단시키고 디버깅 수행
  - 코드에 `debugger`를 선언하는 것과 동일한 역할을 하지만 소스코드를 오염시키지 않아 더욱 유용
- 웹사이트 디버깅 시 요소 탭과 더불어 가장 자주 사용되는 도구

<br>

# 7.4 네트워크 탭

- HTTP 요청부터 웹 소켓까지 웹페이지가 외부 데이터와 통신하는 정보를 확인
- 스크린샷 캡쳐 기능
  - 코드 내부의 `fetch` 요청 이외에도 외부 CDN에서 가져오는 이미지 리소스 요청 등도 확인 가능
  - 따라서 사용자에게 먼저 노출되거나, 노출되는 영역이 큰 중요한 콘텐츠가 우선적으로 다운로드 되는지, 우선순위가 낮은 이미지가 나중에 다운로드되는지 등을 확인할 수 있는 기능

#### 네트워크 탭을 통해 집중적으로 확인해 볼 점

- 불필요한 요청 또는 중복되는 요청이 없는지
- 웹페이지 구성에 필요한 리소스 크기가 너무 크지는 않은지
- 리소스 로딩 속도는 적절한지, 또는 너무 오래 걸리는 리소스는 없는지
- 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

<br>

# 7.5 메모리 탭

- 애플리케이션에서 발생하는 메모리 누수, 속도 저하, 웹페이지 프리징 현상을 확인할 수 있는 도구

### 프로파일링

메모리 탭을 열면 리액트 개발 도구의 프로파일과 비슷하게 프로파일링 작업을 거쳐야 원하는 정보를 볼 수 있는지 확인할 수 있다.

다른 개발자 도구인 요소나 다른 탭과는 다르게 메모리 탭 그 자체만으로는 아무것도 할 수 없다.

프로파일 유형은 다음과 같이 크게 세 가지가 있다.

#### 힙 스냅샷

현재 메모리 상황을 사진 찍듯 촬영할 수 있다. 현 시점의 메모리 상황을 알고 싶다면 힙 스냅샷을 활용하면 된다.

#### 타임라인의 할당 계측

현 시점의 메모리 상황이 아닌 시간의 흐름에 따라 메모리의 변화를 살펴볼 때 사용한다.

주로 로딩이 되는 과정의 메모리 변화 또는 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용한다.

#### 할당 샘플링

메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

<br>

# 7.6 Next.js 환경 디버깅하기

크롬 메모리 탭을 활용해 디버깅하는 방법은 모두 클라이언트 자바스크립트 환경을 디버깅한 예제였다.

그러나 만약 서버 사이드 렌더링을 수행하는 자바스크립트 환경에서 메모리 누수가 발생한다면 어떻게 될까? 놀랍게도 서버 환경도 동일하게 크롬 개발자 도구로 디버깅이 가능하다.

## 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기

가장 먼저 할 일은 Next.js 프로젝트를 디버그 모드로 실행하는 것이다.

```
"dev": NODE_OPTIONS='--inspect' next dev
```

아래와 같이 웹소켓 주소가 나타나면 디버거에 연결할 준비가 된 것이다.

```bash
npm run dev

> my-app@0.1.0 dev
> NODE_OPTIONS='--inspect' next dev

Debugger listening on ws://127.0.0.1:9229/~
For help, see: https://nodejs.org/en/docs/inspector
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

이후 크롬 브라우저에서 `chrome://inspect`로 이동한다.

<br>

## 7.6.2 Next.js 서버에 트래픽 유입시키기

서버 사이드 렌더링과 같이 서버에서 제공되는 서비스의 경우 서버를 실행한 뒤 사용자가 서서히 유입되면서 메모리 누수가 발생하는 경우가 많다. 따라서 서버에 직접 트래픽을 발생시켜 확인하는 것이 가장 확실한 방법이다.

사용자 트래픽이 서버로 몰리는 상황을 편하게 시뮬레이션하기 위해 오픈소스 도구인 `ab`를 사용한다.

> `ab` : 아파치 재단에서 제공하는 웹서버 성능 검사 도구로 HTTP 서버의 성능을 벤치마킹할 수 있는 도구

터미널에서 다음과 같이 실행한다.

```bash
ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"
```

위 명령어는 `http://127.0.0.1:3000/`를 향해 한 번에 50개의 요청을 총 10,000회 시도한다. 로컬에서 테스트하는 경우 주소를 `localhost`로 하면 정상적으로 실행되지 않으니 반드시 IP나 올바른 주소를 기재해야 한다.
